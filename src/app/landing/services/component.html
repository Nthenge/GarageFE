<section class="services">
    <div class="header-container">
        <h2>Our Available Services</h2>
        <p class="section-intro">Explore the range of maintenance and repair services we offer.</p>

        <div class="search-container">
            <mat-form-field appearance="outline" class="search-input">
                <mat-label>Search by Service Name</mat-label>
                <input matInput type="text" [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()" placeholder="e.g., Oil Change">
                <mat-icon matPrefix>search</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="search-input">
                <mat-label>Filter by Price</mat-label>
                <input matInput type="number" [(ngModel)]="priceFilter" (ngModelChange)="onSearchChange()" placeholder="e.g., 2200">
                <mat-icon matPrefix>filter_list</mat-icon>
            </mat-form-field>
        </div>
    </div>

    @if (loading) {
        <p class="status-message">Loading services...</p>
    } @else if (errorMessage) {
        <p class="status-message error-message">{{ errorMessage }}</p>
    } @else if (paginatedServices.length > 0) { 
        <div class="service-grid">
            @for (service of paginatedServices; track service.id) { 
                <mat-card class="service-card">
                    <mat-card-header>
                        <mat-card-title>{{ service.serviceName }}</mat-card-title>
                        <mat-card-subtitle>{{ service.categoryName }}</mat-card-subtitle>
                    </mat-card-header>
                    
                    <mat-card-content>
                        <p class="description">{{ service.description }}</p>

                        <div class="price-duration-details">
                            <div class="detail-item">
                                <mat-icon color="primary">attach_money</mat-icon>
                                <span class="price-value">{{ service.price | currency:'KES':'symbol':'1.2-2' }}</span>
                            </div>
                            
                            @if (service.avgDuration) {
                                <div class="detail-item">
                                    <mat-icon>schedule</mat-icon>
                                    <span>{{ service.avgDuration }} hrs</span>
                                </div>
                            }
                            
                            @if (service.garageName) {
                                <div class="detail-item">
                                    <mat-icon>location_on</mat-icon>
                                    <span>{{ service.garageName }}</span>
                                </div>
                            }
                        </div>
                    </mat-card-content>
                    
                    <mat-card-actions>
                        <button mat-button class="book-btn" (click)="handleBookNowClick(service)">Book Now</button>
                    </mat-card-actions>
                </mat-card>
            }
        </div>

        <div class="pagination-controls">
            <button mat-flat-button color="primary" 
                    (click)="goToPage(currentPage - 1)" 
                    [disabled]="currentPage === 1">
                Previous
            </button>
            <span class="page-indicator">Page {{ currentPage }} of {{ totalPages }}</span>
            <button mat-flat-button color="primary" 
                    (click)="goToPage(currentPage + 1)" 
                    [disabled]="currentPage === totalPages || totalPages === 0">
                Next
            </button>
        </div>

    } @else {
        <p class="status-message">No services found at this time.</p>
    }
</section>