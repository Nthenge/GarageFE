<div class="page-wrapper">
  <div class="reset-password-container">
  <!-- Loading -->
  <div *ngIf="checkingToken" class="loading-state">
    <div class="spinner-large"></div>
    <p>Verifying reset link...</p>
  </div>

  <!-- Invalid Token -->
  <div *ngIf="!checkingToken && !tokenValid" class="error-state">
    <div class="error-icon">⚠️</div>
    <h2>Invalid Reset Link</h2>
    <div class="alert alert-error">
      <span class="alert-icon">⚠</span>
      {{ errorMessage }}  
    </div>
    <p>This link may have expired or been used already.</p>
    <button class="submit-btn" (click)="onCancel()">Back to Login</button>
  </div>

  <!-- Form -->
  <div *ngIf="!checkingToken && tokenValid" class="form-wrapper">
    <div class="modal-header">
      <div class="icon-wrapper">
        <span class="key-icon"></span>
      </div>
      <h2>Reset Password</h2>
      <p>Enter your new password below</p>
    </div>

    <!-- Success/Error -->
    <div *ngIf="successMessage" class="alert alert-success">
      <span class="alert-icon">✓</span> {{ successMessage }}
      <p class="redirect-text">Redirecting to login...</p>
    </div>

    <div *ngIf="errorMessage && !successMessage" class="alert alert-error">
      <span class="alert-icon">⚠</span> {{ errorMessage }}
    </div>

    <!-- Form -->
    <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label>New Password <span class="required">*</span></label>
        <input type="password" formControlName="newPassword" placeholder="Enter new password"
               [class.error-input]="resetPasswordForm.get('newPassword')?.touched && resetPasswordForm.get('newPassword')?.invalid">
        <span *ngIf="resetPasswordForm.get('newPassword')?.touched && resetPasswordForm.get('newPassword')?.hasError('required')" class="error-text">
          Password is required
        </span>
        <span *ngIf="resetPasswordForm.get('newPassword')?.touched && resetPasswordForm.get('newPassword')?.hasError('minlength')" class="error-text">
          Password must be at least 6 characters
        </span>
      </div>

      <div class="form-group">
        <label>Confirm Password <span class="required">*</span></label>
        <input type="password" formControlName="confirmPassword" placeholder="Confirm new password"
               [class.error-input]="(resetPasswordForm.get('confirmPassword')?.touched && resetPasswordForm.get('confirmPassword')?.invalid) || passwordMismatch">
        <span *ngIf="resetPasswordForm.get('confirmPassword')?.touched && resetPasswordForm.get('confirmPassword')?.hasError('required')" class="error-text">
          Please confirm your password
        </span>
        <span *ngIf="passwordMismatch" class="error-text">
          Passwords do not match
        </span>
      </div>

      <button type="submit" class="submit-btn"
              [disabled]="isLoading || resetPasswordForm.invalid || passwordMismatch"
              [class.loading]="isLoading">
        <span *ngIf="!isLoading">Reset Password</span>
        <span *ngIf="isLoading" class="spinner"></span>
        <span *ngIf="isLoading">Resetting...</span>
      </button>
    </form>
  </div>
</div>

</div>